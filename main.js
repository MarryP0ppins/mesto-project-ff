(()=>{"use strict";var e="https://nomoreparties.co/v1/cohort-mag-4",t="6878c6bd-80e8-49e3-abf9-36ab4df4915c",n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},o=document.querySelector("#card-template").content.querySelector(".places__item");function r(o){var r=o.currentTarget,a=r.targetElement,u=a.getAttribute("id");u=u.replace(/^card/,"");var i=null;i=r.classList.contains("card__like-button_is-active")?function(o){return fetch("".concat(e,"/cards/likes/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(n)}(u):function(o){return fetch("".concat(e,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:t}}).then(n)}(u),i.then((function(e){a.querySelector(".card__like-quantity").textContent=e.likes.length,c(o.target)})).catch((function(e){console.log(e)}))}function c(e){e.classList.toggle("card__like-button_is-active")}function a(o){var r=o.currentTarget.targetElement,c=r.getAttribute("id");(function(o){return fetch("".concat(e,"/cards/").concat(o),{method:"DELETE",headers:{authorization:t}}).then(n)})(c=c.replace(/^card/,"")).then((function(e){r.remove()})).catch((function(e){console.log(e)}))}function u(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",u),document.addEventListener("mousedown",s),document.addEventListener("mouseup",p)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",u),document.removeEventListener("mousedown",s),document.removeEventListener("mouseup",p)}function s(e){e.target.classList.contains("popup_is-opened")&&(e.target.isClickOnThis=!0)}function p(e){e.target.isClickOnThis&&e.target.classList.contains("popup_is-opened")&&(e.preventDefault(),l(e.target)),e.target.isClickOnThis=!1}var d=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},_=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};function m(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){d(e,n,t)})),_(n,o,t)}var f=document.querySelector(".profile__edit-button"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup__input_type_name"),h=document.querySelector(".popup__input_type_description"),S=document.querySelector(".popup__input_type_card-name"),g=document.querySelector(".popup__input_type_url"),q=document.querySelector(".popup__input_type_url_avatar"),b=document.querySelector(".profile__image-avtar-edit"),E=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_edit_avatar"),k=document.querySelector(".popup_type_edit .popup__close"),x=document.querySelector(".popup_type_new-card .popup__close"),T=document.querySelector(".popup_type_image .popup__close"),A=document.querySelector(".popup_type_edit_avatar .popup__close"),z=document.querySelector(".popup_type_image"),O=document.querySelector('[name="new-place"]'),w=document.querySelector('[name="edit-profile"]'),B=document.querySelector('[name="edit-avatar"]'),D=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),N=document.querySelector(".places__list"),J=function(e,t){return function(e,t,n,r,a){var u=o.cloneNode(!0),i=u.querySelector(".card__image"),l=u.querySelector(".card__like-button"),s=u.querySelector(".card__delete-button");return e.owner._id==t&&s.classList.add("card__delete-button-visible"),u.querySelector(".card__like-quantity").textContent=e.likes.length,t&&e.likes.some((function(e){return e._id==t}))&&c(l),s.addEventListener("click",n),s.targetElement=u,u.querySelector(".card__title").textContent=e.name,i.setAttribute("alt",e.name),i.setAttribute("src",e.link),u.setAttribute("id","card".concat(e._id)),i.addEventListener("click",a),l.addEventListener("click",r),l.targetElement=u,u}(e,t,a,r,I)},G=null,H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"};function I(e){z.querySelector(".popup__image").removeAttribute("src"),z.querySelector(".popup__caption").textContent=e.target.parentElement.querySelector(".card__title").textContent,z.querySelector(".popup__image").setAttribute("src",e.target.src),z.querySelector(".popup__image").setAttribute("alt",e.target.alt),i(z)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?d(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass);var r=t.validationMessage;t.validity.patternMismatch&&t.getAttribute("data-pattern-mismatch-message")&&(r=t.getAttribute("data-pattern-mismatch-message")),o.textContent=r,o.classList.add(n.errorClass)}(e,t,n)}(e,r,t),_(n,o,t)}))}))}(t,e)}))}(H),b.addEventListener("click",(function(){i(L)})),f.addEventListener("click",(function(){v.value=D.textContent,h.value=P.textContent,m(w,H),i(y)})),E.addEventListener("click",(function(){i(C)})),B.addEventListener("submit",(function(o){o.preventDefault();var r,c=q.value,a=o.currentTarget.querySelector(".popup__button");a.textContent="Сохранение...",(r=c,fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then(n)).then((function(e){j.style.backgroundImage="url(".concat(e.avatar,")"),B.reset(),l(L),m(B,H)})).catch((function(e){console.log(e)})).finally((function(){a.textContent="Сохранить"}))})),w.addEventListener("submit",(function(o){o.preventDefault();var r,c,a=v.value,u=h.value,i=o.currentTarget.querySelector(".popup__button");i.textContent="Сохранение...",(r=a,c=u,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:c})}).then(n)).then((function(e){D.textContent=e.name,P.textContent=e.about,l(y)})).catch((function(e){console.log(e)})).finally((function(){i.textContent="Сохранить"}))})),O.addEventListener("submit",(function(o){o.preventDefault();var r,c,a=S.value,u=g.value,i=o.currentTarget.querySelector(".popup__button");i.textContent="Сохранение...",(r=a,c=u,fetch("".concat(e,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:r,link:c})}).then(n)).then((function(e){N.prepend(J(e,G)),O.reset(),l(C),m(O,H)})).catch((function(e){console.log(e)})).finally((function(){i.textContent="Сохранить"}))})),A.addEventListener("click",(function(){l(L)})),k.addEventListener("click",(function(){l(y)})),x.addEventListener("click",(function(){l(C)})),T.addEventListener("click",(function(){l(z)})),Promise.all([fetch("".concat(e,"/cards"),{method:"GET",headers:{authorization:t}}).then(n),fetch("".concat(e,"/users/me"),{method:"GET",headers:{authorization:t}}).then(n)]).then((function(e){D.textContent=e[1].name,P.textContent=e[1].about,j.style.backgroundImage="url('".concat(e[1].avatar,"')"),G=e[1]._id,e[0].forEach((function(e){N.append(J(e,G))}))})).catch((function(e){console.log(e)}))})();